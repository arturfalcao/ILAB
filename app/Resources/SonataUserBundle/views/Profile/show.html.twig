{% if app.user %}

{% block stylesheets %}
	<link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/bootstrap.css') }}" />
	<link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/topheadergeral.css') }}" />
	<link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/fontes_awesome.css') }}" />
	<link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/perfil.css') }}" />
{% endblock %}

{% stylesheets '@AppBundle/Resources/public/css/*' %}
<link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/app.css') }}" />
<link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/style.css') }}" />
<link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/menu.css') }}" />

<link rel="stylesheet" href="https://cdn.rawgit.com/angular-ui/bower-ui-grid/master/ui-grid.min.css">


{% endstylesheets %}



{% block javascripts %}
	<script type="text/javascript" src="{{ asset('bundles/bmatznerfoundation/js/vendor/jquery.js') }}"></script>
	<script type="text/javascript" src="{{ asset('bundles/bmatznerfoundation/js/foundation.min.js') }}"></script>
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/fullcalendar.min.js"></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src="https://cdn.rawgit.com/angular-ui/bower-ui-grid/master/ui-grid.min.js"></script>
	<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
	<script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>

	<script type="text/javascript" src="{{ asset('bundles/app/js/calendar-settings.js') }}"></script>
	<script type="text/javascript" src="{{ asset('bundles/app/js/ajaxsave.js') }}"></script>

{% endblock %}

<style>

</style>


<div class="container-fluid">
	<div class="row">
		<div class="large-1 columns" style="border: 1px solid #DFDFDF;padding-left: 22px;">
			{% include 'default/menu.html.twig' %}
		</div>

		<div class="large-15 columns">
			<div class="row">
				<div class="large-16 columns">
					{% include 'default/profile.html.twig' %}
				</div>
			</div>
			<div class="row linha_branco"><div class="col-md-12">0</div></div>
			<div class="row linha_branco" ><div class="col-md-12">0</div></div>
			<div class="row linha_branco"><div class="col-md-12">0</div></div>
			<div class="row linha_branco"><div class="col-md-12">0</div></div>
			<div class="row linha_branco"><div class="col-md-12">0</div></div>
			<div class="row linha_branco"><div class="col-md-12">0</div></div>
			<div class="row linha_branco"><div class="col-md-12">0</div></div>

			<form id="form" action="/app_dev.php/sucesso" method="post" enctype="multipart/form-data">
				<input type="hidden" id="util" name="util" value="{{app.user.id}}">
				<div class="row">
					<div class="col-md-4 linha_branco" >0</div>
					<div class="col-md-2"><h6 class="grupo">Identificação</h6></div>
					<div class="col-md-6 linha_branco">0</div>
				</div>
				<div class="col-md-1 linha_branco" >0</div>
				<div class="row">
					<div class="col-md-2">

						<img id="img_perfil" class="imagem_redonda"
							 name="img_perfil" src="" alt="" height="220px" width="220px";>
					</div>
					<div class="col-md-1" >
						<div class="image-upload">
							<label for="file-input">
								<img src="/bundles/app/images/editar-perfil.png"/>
							</label>

							<input id="file-input" type="file" name="file-input"/>
						</div>
					</div>

					<div class="row">
						<div class="col-md-2">
							<label class="cor_label">Primeiro nome<span class="cor_asterisco">*</span></label>
						</div>
						<div class="col-md-2">
							<label class="cor_label">Último nome<span class="cor_asterisco">*</span></label>
						</div>
						<div class="col-md-2">
							<label class="cor_label">Email<span class="cor_asterisco">*</span></label>
						</div>

						<div class="col-md-2" >
							<input id="primeiro_nome" type="text"
								   name="primeiro_nome" value="{{app.user.firstname}}" required>
						</div>

						<div class="col-md-2">
							<input id="ultimo_nome" type="text"
								   name="ultimo_nome" value="{{app.user.lastname}}" required>
						</div>

						<div class="col-md-3">
							<input id="email" type="text" name="email" value="{{app.user.email}}" required>
						</div>
						<div class="col-md-1 linha_branco">0</div>
						<div class="col-md-2">
							<label class="cor_label">Cargo<span class="cor_asterisco">*</span></label>
						</div>
						<div class="col-md-2">
							<label class="cor_label">Género<span class="cor_asterisco">*</span></label>
						</div>
						<div class="col-md-3 linha_branco">
							0
						</div>
						<!--
                        margin-left 660px na identificação
                        margin-right -130px na imagem
                        col-md-offset-1 no cargo e primeiro_nome-->
						<div class="col-md-1 linha_branco">0</div>
						<div class="col-md-2">
							<div class="styled-select">
								<select id="cargo" name="cargo">
									<option value="tecnica">Técnica</option>
									<option value="diretora">Diretora</option>
									<option value="engenheiro">Engenheiro</option>
									<option value="outro">Outro</option>
								</select>
							</div>
						</div>

						<div class="col-md-2">
							<div class="styled-select">
								<select id="genero" name="genero">
									<option value="f">Feminino</option>
									<option value="m">Masculino</option>
									<option value="u">Outro</option>
								</select>
							</div>
						</div>

						<div class="col-md-3">
							<button id="alt_password" data-popup-open="popup-1" style="padding: 5px 43px;"
									class="hollow-button buttons-center">Alterar password</button>
						</div>

					</div>
				</div>

				<div class="row linha_branco">0</div>
				<div class="row" style="border: 1px solid #dfdfdf;"></div>
				<div class="row linha_branco">0</div>
				<div class="row linha_branco">0</div>
				<div class="row">
					<div class="col-md-4 linha_branco">0</div>
					<div class="col-md-3"><h6 class="grupo">Dados pessoais (complementares)</h6></div>
					<div class="col-md-5 linha_branco">0</div>
				</div>

				<div class="row">
					<div class="col-md-4 linha_branco">0</div>
					<div class="col-md-2">
						<h6 class="grupo"><label class="cor_label">Data de nascimento</label></h6>
					</div>
					<div class="col-md-2 linha_branco">0</div>
					<div class="col-md-2">
						<label class="cor_label pos_label_morada">Morada</label>
					</div>
					<div class="col-md-6 linha_branco">0</div>
				</div>

				<div class="row">
					<div class="col-md-4 linha_branco">0</div>
					<div class="col-md-1">
						<div class="styled-select">
							<select id="data_dia" name="data_dia">
								<option value="" disabled selected style="color:#dfdfdf">Dia</option>
								<option value="01">1</option>
								<option value="02">2</option>
								<option value="03">3</option>
								<option value="04">4</option>
								<option value="05">5</option>
								<option value="06">6</option>
								<option value="07">7</option>
								<option value="08">8</option>
								<option value="09">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
								<option value="13">13</option>
								<option value="14">14</option>
								<option value="15">15</option>
								<option value="16">16</option>
								<option value="17">17</option>
								<option value="18">18</option>
								<option value="19">19</option>
								<option value="20">20</option>
								<option value="21">21</option>
								<option value="22">22</option>
								<option value="23">23</option>
								<option value="24">24</option>
								<option value="25">25</option>
								<option value="26">26</option>
								<option value="27">27</option>
								<option value="28">28</option>
								<option value="29">29</option>
								<option value="30">30</option>
								<option value="31">31</option>
							</select>
						</div>
					</div>

					<div class="col-md-2">
						<div class="styled-select">
							<select id="data_mes" name="data_mes">
								<option value="" disabled selected style="color:#dfdfdf">Mês</option>
								<option value="01">Janeiro</option>
								<option value="02">Feveiro</option>
								<option value="03">Março</option>
								<option value="04">Abril</option>
								<option value="05">Maio</option>
								<option value="06">Junho</option>
								<option value="07">Julho</option>
								<option value="08">Agosto</option>
								<option value="09">Setembro</option>
								<option value="10">Outubro</option>
								<option value="11">Novembro</option>
								<option value="12">Dezembro</option>
							</select>
						</div>
					</div>

					<div class="col-md-1">
						<div class="styled-select">
							<select id="data_ano" name="data_ano">
							</select>
						</div>
					</div>

					<div class="col-md-3">
          <textarea id="morada" name="morada">
    	    </textarea>
					</div>
					<div class="col-md-1 linha_branco">0</div>
					<div class="col-md-2 col-md-offset-4">
						<label class="cor_label">Telefone</label>
					</div>
					<div class="col-md-2">
						<label class="cor_label">Telemóvel</label>
					</div>

				</div>

				<div class="row">
					<div class="col-md-4 linha_branco">0</div>
					<div class="col-md-2">
						<input id="telefone" type="text" maxlength="64" name="telefone" value="{{app.user.phone}}">
					</div>

					<div class="col-md-2">
						<input id="telemovel" type="text" maxlength="64" name="telemovel" value="">
					</div>

					<div class="col-md-1">
						<input id="cp_1" pattern="[0-9]{4}" placeholder="Cód. P." type="text" maxlength="4" name="cp_1" value="">
					</div>
					<div class="col-md-1">
						<input id="cp_2" pattern="[0-9]{3}" placeholder="000" type="text" name="cp_2" maxlength="3" value="">
					</div>

					<div class="col-md-1">
						<input id="cidade" placeholder="Cidade" type="text" maxlength="100" name="cidade" value="">
					</div>
					<div class="col-md-1 linha_branco">0</div>
				</div>

				<div class="row linha_branco">0</div>
				<div class="row" style="border: 1px solid #dfdfdf;"></div>
				<div class="row linha_branco">0</div>

				<div class="row">
					<div class="col-md-5 linha_branco">0</div>
					<div class="col-md-2 ">
						<button type="submit" id="g_sair" class="buttons-center hollow-button">
							<img src="/bundles/app/images/icon-button-2.png" alt="">
							<span>Guardar e sair</span>
						</button>
					</div>
					<div class="col-md-1 linha_branco">0</div>
					<div class="col-md-2 ">
						<button id="cancelar" class="buttons-center hollow-button">
							<img src="/bundles/app/images/close.png" alt="">
							<span>Cancelar</span>
						</button>
					</div>
				</div>


				<div class="popup" data-popup="popup-1">
					<div class="popup-inner">
						<img data-popup-close="popup-1" id="fecha_botao" src="/bundles/app/images/close.png" alt="">
						<label class="cor_label pos_label_old_pass">Password antiga<span class="cor_asterisco">*</span></label>
						<input id="pass_antiga" type="password" name="pass_antiga" value="">

						<label class="cor_label pos_label_new_pass">Nova password<span class="cor_asterisco">*</span></label>
						<input id="pass_nova" type="password" name="pass_nova" value="">

						<label class="cor_label pos_label_r_new_pass">Reescreva a nova password<span class="cor_asterisco">*</span></label>
						<input id="r_pass_nova" type="password" name="re_pass_nova" value="">

						<button id="g_sair_1"class="buttons-center hollow-button"><img src="/bundles/app/images/icon-button-2.png" alt=""><span>Guardar</span></button>
						<button data-popup-close="popup-1" id="cancelar_1" class="buttons-center hollow-button"><img src="/bundles/app/images/close.png" alt=""><span>Cancelar</span></button>

					</div>
				</div>


			</form>

			<script>
				$( document ).ready(function() {

					$('[data-popup-open]').on('click', function(e)  {
						var targeted_popup_class = $(this).attr('data-popup-open');
						$('[data-popup="' + targeted_popup_class + '"]').fadeIn(350);

						e.preventDefault();
					});

					$('#cancelar').on('click', function(e)  {
						window.location.href = '/app_dev.php/calendar';
						e.preventDefault();
					});

					//----- CLOSE
					$('[data-popup-close]').on('click', function(e)  {
						var targeted_popup_class = $(this).attr('data-popup-close');
						$('[data-popup="' + targeted_popup_class + '"]').fadeOut(350);

						e.preventDefault();
					});
					var ok;
					$('#g_sair_1').on('click', function(e)  {
						var pass_antiga = $("#pass_antiga").val();
						var pass_nova = $("#pass_nova").val();
						var r_pass_nova = $("#r_pass_nova").val();
						var user = Number($('#util').val());

						$.ajax({
							type: "POST",
							url: '{{path('chat_validapass')}}',
							data: {id: user, password: pass_antiga},
							success: function(data) {
								var ok = Number(data);
								if(ok == 0)
								{
									$("#pass_antiga").val('');
									e.preventDefault();
								}

							}
						});


						if(pass_nova != r_pass_nova)
						{
							$("#pass_nova").val('');
							$("#r_pass_nova").val('');
							e.preventDefault();
						}
						else{
							if(pass_nova.length > 0)
							{
								$.ajax({
									type: "POST",
									url: '{{path('chat_mudapass')}}',
									data: {id: user, password: pass_nova},
									success: function(data) {

									}
								});
							}
							$(".popup").hide();
							e.preventDefault();
						}

					});

					var d = new Date();
					var n = d.getFullYear();

					$("#data_ano").append('<option value="" disabled selected style="color:#dfdfdf">Ano</option>');

					for(var i=n-150;i<=n;i++)
					{
						$("#data_ano").append('<option value="' + i + '">' + i + '</option>');
					}

					$("#file-input").change(function(e){
						var URL = window.URL;
						var url = URL.createObjectURL(e.target.files[0]);
						$("#img_perfil").attr("src", url);

					});

					var user = Number($('#util').val());
					$.ajax({
						type: "POST",
						url: '{{path('chat_getdusers')}}',
						data: {id: user},
						success: function(data) {

							var arr = $.parseJSON(data);
							if(arr.length != 0)
							{
								$.each(arr, function(index,value) {

									var imagem = value.imagem;
									if(imagem)
									{
										imagem = imagem.replace('"','');
										imagem = imagem.replace('"','');
										imagem = imagem.replace(/\\/g,'');
										$("#img_perfil").attr("src", imagem);
									}

									$("#telemovel").val(value.telemovel);
									$("#morada").val(value.morada);
									var cp = value.codigopostal;
									if(cp)
									{
										var n = cp.search('-');
										var cp_1 = cp.slice(0,n);
										var cp_2 = cp.slice(n+1);

										$("#cp_1").val(cp_1);
										$("#cp_2").val(cp_2);
									}
									$("#cidade").val(value.cidade);

									var data_nasc = value.data;
									if(data_nasc)
									{
										data_nasc = value.data.date;
										var n=data_nasc.search(' ');
										data_nasc = data_nasc.slice(0,n);
										n = data_nasc.search('-');
										var ano = data_nasc.slice(0,n);
										var aux2 = data_nasc.slice(n+1);
										n = aux2.search('-');
										var mes=aux2.slice(0,n);
										var dia=aux2.slice(n+1);

										$("#data_dia").val(dia);

										$("#data_mes").val(mes);

										$("#data_ano").val(ano);
									}

								});



							}
						}

					});



				});


			</script>


			{% endif %}
