{% block form %}
    {{ sonata_block_render_event('sonata.admin.edit.form.top', { 'admin': admin, 'object': object }) }}

    {% set url = admin.id(object) is not null ? 'edit' : 'create' %}

    {% if not admin.hasRoute(url)%}

        <div>
            {{ "form_not_available"|trans({}, "SonataAdminBundle") }}
        </div>

    {% else %}
        <script type="text/javascript" src="{{ asset('bundles/app/js/node_modules/jquery-bootgrid/dist/jquery.bootgrid.js') }}"></script>
        <link href="{{ asset('bundles/app/js/node_modules/jquery-bootgrid/dist/jquery.bootgrid.css') }}" rel="stylesheet">
        <script>
            $(function() {
                $( "#tabs" ).tabs();
                $( "#tabs2" ).tabs();
            });
        </script>
        <div id="tabs">
            <ul>
                <li><a href="#tabs-1">{{ "Identificação"|convert_encoding('UTF-8', ' iso-8859-1') }}</a></li>
                <li><a href="#tabs-2">{{ "Parâmetros"|convert_encoding('UTF-8', ' iso-8859-1') }}</a></li>
                <li><a href="#tabs-3">{{ "Ciclo de Vida"|convert_encoding('UTF-8', ' iso-8859-1') }}</a></li>
            </ul>
            <div id="tabs-1">
                <form class=""
                      {% if admin_pool.getOption('form_type') == 'horizontal' %}class="form-horizontal"{% endif %}
                      role="form"
                      action="{{ admin.generateUrl(url, {'id': admin.id(object), 'uniqid': admin.uniqid, 'subclass': app.request.get('subclass')}) }}" {{ form_enctype(form) }}
                      method="POST"
                        {% if not admin_pool.getOption('html5_validate') %}novalidate="novalidate"{% endif %}
                        >
                    {% if form.vars.errors|length > 0 %}
                        <div class="sonata-ba-form-error">
                            {{ form_errors(form) }}
                        </div>
                    {% endif %}

                    {% block sonata_pre_fieldsets %}
                    <div class="row">
                        {% endblock %}
                        {% block sonata_tab_content %}
                            {% set has_tab = ((admin.formtabs|length == 1 and admin.formtabs|keys[0] != 'default') or admin.formtabs|length > 1 ) %}

                            <div class="col-md-12">
                                {% if has_tab %}
                                    <div class="nav-tabs-custom">
                                        <ul class="nav nav-tabs" role="tablist">
                                            {% for name, form_tab in admin.formtabs %}
                                                <li{% if loop.index == 1 %} class="active"{% endif %}><a href="#tab_{{ loop.index }}" data-toggle="tab"><span class="glyphicon glyphicon-exclamation-sign has-errors hide"></span> {{ admin.trans(name, {}, form_tab.translation_domain) }}</a></li>
                                            {% endfor %}
                                        </ul>
                                        <div class="tab-content">
                                            {% for code, form_tab in admin.formtabs %}
                                                <div class="tab-pane fade{% if loop.first %} in active{% endif %}" id="tab_{{ loop.index }}">
                                                    <div class="box-body  container-fluid">
                                                        <div class="sonata-ba-collapsed-fields">

                                                            {% if form_tab.description != false %}
                                                                <p>{{ form_tab.description|raw }}</p>
                                                            {% endif %}

                                                            {{ form_helper.render_groups(admin, form, form_tab['groups'], has_tab) }}
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% else %}

                                    {{ form_helper.render_groups(admin, form, admin.formtabs['default'].groups, has_tab) }}
                                {% endif %}
                            </div>
                        {% endblock %}
                        {% block sonata_post_fieldsets %}
                    </div>
                    {% endblock %}

                    {{ form_rest(form) }}

                    {% block formactions %}
                        <div class="well well-small form-actions">
                            {% if app.request.isxmlhttprequest %}
                                {% if admin.id(object) is not null %}

                                    <button type="submit" class="btn btn-success" name="btn_update"><i class="fa fa-save"></i> {{ 'btn_update'|trans({}, 'SonataAdminBundle') }}</button>
                                {% else %}

                                    <button type="submit" class="btn btn-success" name="btn_create"><i class="fa fa-plus-circle"></i> {{ 'btn_create'|trans({}, 'SonataAdminBundle') }}</button>
                                {% endif %}
                            {% else %}
                                {% if admin.supportsPreviewMode %}
                                    <button class="btn btn-info persist-preview" name="btn_preview" type="submit">
                                        <i class="fa fa-eye"></i>
                                        {{ 'btn_preview'|trans({}, 'SonataAdminBundle') }}
                                    </button>
                                {% endif %}
                                {% if admin.id(object) is not null %}

                                    <button type="submit" class="btn btn-success" name="btn_update_and_edit"><i class="fa fa-save"></i> {{ 'btn_update_and_edit_again'|trans({}, 'SonataAdminBundle') }}</button>
                                    {% if admin.hasroute('list') and admin.isGranted('LIST') %}
                                        <button type="submit" class="btn btn-success" name="btn_update_and_list"><i class="fa fa-save"></i> <i class="fa fa-list"></i> {{ 'btn_update_and_return_to_list'|trans({}, 'SonataAdminBundle') }}</button>
                                    {% endif %}

                                    {% if admin.hasroute('delete') and admin.isGranted('DELETE', object) %}
                                        <a class="btn btn-danger" href="{{ admin.generateObjectUrl('delete', object) }}"><i class="fa fa-minus-circle"></i> {{ 'link_delete'|trans({}, 'SonataAdminBundle') }}</a>

                                        {% set currentPath = path(app.request.attributes.get('_route'),
                                        app.request.attributes.get('_route_params')) %}

                                        <a target="_blank" class="btn generateworklist" href="/generateworklist/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Gerar lista de trabalho</a>
                                        <a target="_blank" class="btn generateworklist" href="/completesample/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Autorizar </a>
                                        <a target="_blank" class="btn generateworklist" href="/reopensample/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Desautorizar </a>
                                        <a target="_blank" class="btn generateworklist" href="/cancelsample/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Cancelar </a>
                                        <a target="_blank" class="btn generateworklist" href="/notifysample/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Notificar Cliente </a>


                                    {% endif %}

                                    {% if admin.isAclEnabled() and admin.hasroute('acl') and admin.isGranted('MASTER', object) %}
                                        <a class="btn btn-info" href="{{ admin.generateObjectUrl('acl', object) }}"><i class="fa fa-users"></i> {{ 'link_edit_acl'|trans({}, 'SonataAdminBundle') }}</a>
                                    {% endif %}
                                {% else %}
                                    {% if admin.hasroute('edit') and admin.isGranted('EDIT') %}
                                        <button class="btn btn-success" type="submit" name="btn_create_and_edit"><i class="fa fa-save"></i> {{ 'btn_create_and_edit_again'|trans({}, 'SonataAdminBundle') }}</button>
                                    {% endif %}
                                    {% if admin.hasroute('list') and admin.isGranted('LIST') %}
                                        <button type="submit" class="btn btn-success" name="btn_create_and_list"><i class="fa fa-save"></i> <i class="fa fa-list"></i> {{ 'btn_create_and_return_to_list'|trans({}, 'SonataAdminBundle') }}</button>
                                    {% endif %}
                                    <button class="btn btn-success" type="submit" name="btn_create_and_create"><i class="fa fa-plus-circle"></i> {{ 'btn_create_and_create_a_new_one'|trans({}, 'SonataAdminBundle') }}</button>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endblock formactions %}
                </form>
            </div>
            <div id="tabs-2">
                <div class="row">
                    <div class="col-md-6">
                        <table id="parametros_grid" class="table table-condensed table-hover table-striped">
                            <thead>
                            <tr>
                                <th data-width="60" data-column-id="fn_id" data-type="numeric" data-identifier="true">ID</th>
                                <th data-width="40" data-column-id="ft_codigo" data-type="numeric" >E</th>
                                <th data-column-id="resultado">Parâmetro</th>
                                <th data-column-id="parametros" >Resultado</th>
                                <th data-column-id="ft_formatado">Valor</th>
                                <th data-column-id="unidades">Unidades</th>
                                <th data-column-id="ft_texto_relatorio">Limite</th>
                            </tr>
                            </thead>
                        </table>

                    </div>
                    <div class="col-md-6">
                        <div id="tabs2">
                            <ul>
                                <li><a href="#tabs-4">{{ "Geral"|convert_encoding('UTF-8', ' iso-8859-1') }}</a></li>
                                <li><a href="#tabs-5">{{ "Resultado"|convert_encoding('UTF-8', ' iso-8859-1') }}</a></li>
                                <li><a href="#tabs-6">{{ "Ciclo de Vida"|convert_encoding('UTF-8', ' iso-8859-1') }}</a></li>
                            </ul>
                            <div id="tabs-4">

                            </div>
                            <div id="tabs-5">

                            </div>
                            <div id="tabs-6">

                            </div>

                    </div>
                </div>



                </div>
                <div class="row">
                    <a target="_blank" class="btn generateworklist" href="/generateworklist/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Guardar</a>
                    <a target="_blank" class="btn generateworklist" href="/completesample/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Autorizar </a>
                    <a target="_blank" class="btn generateworklist" href="/reopensample/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Desautorizar </a>
                    <a target="_blank" class="btn generateworklist" href="/cancelsample/{{ admin.id(object)  }}"><i class="fa fa-minus-circle"></i> Eliminar</a>
                </div>
            </div>

            <div id="tabs-3">
                <script>
                    $( document ).ready(function() {
                        $.ajax({
                            type: "POST",
                            url: '{{path('AmostrasGetCicloVida')}}',
                            data: {data: {{ admin.id(object)  }} },
                            success: function(data) {
                                var obj = $.parseJSON(data);
                                if (obj.length != 0) {
                                    var html = "";
                                    var estado = "";
                                    var bullet = "";
                                    $.each(obj, function (key, value) {
                                        if(value.ft_id_estado == 'I'){
                                            estado = 'Indisponivel';
                                            bullet = "bullet-gray";
                                        }
                                        if(value.ft_id_estado == 'D'){
                                            estado = 'Em Progresso';
                                            bullet = "bullet-yellow";
                                        }
                                        if(value.ft_id_estado == 'P'){
                                            estado = 'Planeada';
                                            bullet = "bullet-blue";
                                        }
                                        if(value.ft_id_estado == 'C'){
                                            estado = 'Completo';
                                            bullet = "bullet-green";
                                        }
                                        if(value.ft_id_estado == 'X'){
                                            estado = 'Cancelada';
                                            bullet = "bullet-pink";
                                        }
                                        html += '<tr><td><span class="'+ bullet +'"></span>'+ estado +'</td><td>'+ value.updated_by_time +'</td><td>'+value.created_by +'</td></tr>'

                                    });
                                    $('.table_ciclo tbody').append(html);
                                } else {

                                }
                            }
                        });
                    });


                    $( document ).ready(function() {
                        $.ajax({
                            type: "POST",
                            url: '{{path('AmostrasGetParametros')}}',
                            data: {data: {{ admin.id(object)  }} },
                            success: function(data) {

                                var grid_para = $("#parametros_grid").bootgrid({
                                    navigation:0,
                                    selection: true,
                                    keepSelection:true,
                                    rowSelect:true,
                                    multiSelect:true

                                });

                                var obj = $.parseJSON(data);

                                if (obj.length != 0) {
                                    grid_para.bootgrid("append",obj );
                                    $.each(obj, function (key, value) {

                                    });
                                } else {

                                }
                            }
                        });
                    });


                </script>

                <div class="table-padding">
                    <table class="hover table_ciclo">
                        <thead>
                        <tr>
                            <th width="100">Estado</th>
                            <th width="100">Data</th>
                            <th width="150">Utilizador</th>
                        </tr>
                        </thead>
                        <tbody>


                        </tbody>
                    </table>
                </div>

            </div>
        </div>




    {% endif%}

    {{ sonata_block_render_event('sonata.admin.edit.form.bottom', { 'admin': admin, 'object': object }) }}

{% endblock %}
